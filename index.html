<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stress Detection AI</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* General Palette */
            --bg-color: #121212; /* Deeper background */
            --surface-color: #1e1e1e; /* Card surface */
            --surface-secondary: #282828; /* Result/Input background */
            --border-color: #333;
            --text-color: #ffffff;
            --text-secondary: #b3b3b3;

            /* Accent Colors */
            --primary-color: #4CAF50; /* A more pleasant green for primary action */
            --primary-hover: #45a049;
            --primary-active: #3c8d40;
            
            /* Prediction Colors */
            --calm-color: #4CAF50;   /* Green */
            --neutral-color: #FFC107; /* Yellow */
            --stressed-color: #F44336; /* Red */
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 1rem;
            box-sizing: border-box;
            transition: background-color 0.3s;
        }

        .container {
            width: 100%;
            max-width: 550px; /* Slightly narrower for focus */
            background-color: var(--surface-color);
            border-radius: 16px; /* Increased radius */
            padding: 2.5rem;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.05); /* Added subtle inner border/light shadow */
            transition: transform 0.3s ease;
        }
        
        .container:hover {
            transform: translateY(-2px); /* Subtle lift on hover */
        }

        h1 {
            text-align: center;
            color: var(--text-color);
            font-weight: 800; /* Bolder title */
            margin-bottom: 0.25rem;
        }

        p {
            text-align: center;
            color: var(--text-secondary);
            margin-bottom: 2rem;
            font-size: 1rem;
            font-weight: 300;
        }

        textarea {
            width: 100%;
            min-height: 140px;
            box-sizing: border-box;
            padding: 1.25rem;
            border-radius: 12px;
            border: 1px solid var(--border-color);
            background-color: var(--surface-secondary); /* Darker input background */
            color: var(--text-color);
            font-family: 'Inter', sans-serif;
            font-size: 1.05rem;
            resize: vertical;
            margin-bottom: 1.5rem;
            transition: border-color 0.3s, box-shadow 0.3s;
        }

        textarea::placeholder {
            color: var(--text-secondary);
            opacity: 0.6;
        }

        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px rgba(76, 175, 80, 0.2); /* Adjusted focus glow */
        }

        button {
            width: 100%;
            padding: 1.1rem;
            font-size: 1.1rem;
            font-weight: 700;
            background-color: var(--primary-color);
            color: var(--bg-color); /* Dark text on bright button */
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: background-color 0.2s ease, transform 0.1s, box-shadow 0.2s;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        button:hover {
            background-color: var(--primary-hover);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            background-color: var(--primary-active);
            transform: scale(0.99);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        button:disabled {
            background-color: #555;
            color: #ccc;
            cursor: not-allowed;
            box-shadow: none;
        }

        #error-message {
            color: var(--stressed-color);
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.95rem;
            display: none;
        }

        #result-container {
            margin-top: 2rem;
            padding: 1.75rem;
            border-radius: 12px;
            background-color: var(--surface-secondary);
            border: 1px solid var(--border-color);
            display: none;
            box-shadow: inset 0 0 8px rgba(0, 0, 0, 0.2);
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.1rem;
            padding: 0.5rem 0;
        }
        
        .result-item:first-child {
            padding-top: 0;
        }
        .result-item:last-child {
            padding-bottom: 0;
        }

        #prediction-label {
            font-weight: 800; /* Extra bold for prediction */
            font-size: 1.4rem;
            padding: 0.4rem 1rem;
            border-radius: 8px;
            min-width: 100px; /* Ensure consistent width */
            text-align: center;
            transition: background-color 0.3s, color 0.3s;
        }
        
        #confidence-label {
            font-weight: 600;
            color: var(--primary-color); /* Highlight confidence */
        }

        /* Dynamic classes for label */
        .calm { background-color: var(--calm-color); color: var(--bg-color); }
        .neutral { background-color: var(--neutral-color); color: #333; }
        .stressed { background-color: var(--stressed-color); color: white; }

        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.15);
            border-left-color: var(--primary-color);
            border-radius: 50%;
            width: 30px; /* Slightly larger spinner */
            height: 30px;
            animation: spin 0.8s linear infinite;
            margin: 2rem auto 0;
            display: none;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        hr {
            border-color: var(--border-color);
            margin: 1rem 0;
            opacity: 0.5; /* Subtler divider */
        }

    </style>
</head>
<body>

    <div class="container">
        <h1>Stress Detection AI ðŸ§ </h1>
        <p>Write down how you're feeling, and the AI will analyze it.</p>
        
        <textarea id="text-input" rows="6" placeholder="e.g., 'I'm feeling really overwhelmed with work today. I haven't slept well and everything is piling up...'"></textarea>
        
        <button id="analyze-button">Analyze My State</button>

        <div class="spinner" id="spinner"></div>

        <div id="error-message"></div>

        <div id="result-container">
            <div class="result-item">
                <span style="font-weight: 500;">AI Prediction:</span>
                <span id="prediction-label">...</span>
            </div>
            <hr>
            <div class="result-item">
                <span style="font-weight: 500;">Confidence Score:</span>
                <span id="confidence-label">... %</span>
            </div>
        </div>
    </div>
<!-- ========================================================= -->
<!--           FIREBASE + FIRESTORE + GOOGLE LOGIN             -->
<!-- ========================================================= -->
<script type="module">

    // IMPORT FIREBASE SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { 
        getFirestore, collection, addDoc, serverTimestamp, 
        getDocs, query, orderBy 
    } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    // YOUR FIREBASE CONFIG (REPLACE!!!!!!!!!!!!!!!!)
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY",
        authDomain: "YOUR_PROJECT.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT.appspot.com",
        messagingSenderId: "YOUR_ID",
        appId: "YOUR_APPID"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    window.db = db;
    window.addDoc = addDoc;
    window.collection = collection;
    window.serverTimestamp = serverTimestamp;
    window.getDocs = getDocs;
    window.orderBy = orderBy;
    window.query = query;

</script>

<!-- ========================================================= -->
<!--                      MAIN SCRIPT                          -->
<!-- ========================================================= -->
<script>
    const API_URL = "http://127.0.0.1:5000/predict";

    const textInput = document.getElementById("text-input");
    const analyzeBtn = document.getElementById("analyze-button");
    const resultContainer = document.getElementById("result-container");
    const historyContainer = document.getElementById("history-container");
    const predictionLabel = document.getElementById("prediction-label");
    const confidenceLabel = document.getElementById("confidence-label");
    const historyList = document.getElementById("history-list");

    analyzeBtn.onclick = async function () {
        const text = textInput.value.trim();
        if (!text) return alert("Please enter something!");

        const response = await fetch(API_URL, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ text })
        });

        const data = await response.json();
        displayResult(data);
        saveToFirebase(text, data.prediction, data.confidence);
    };


    // DISPLAY RESULT
    function displayResult(data) {
        predictionLabel.textContent = data.prediction;
        confidenceLabel.textContent = data.confidence + "%";

        predictionLabel.className = "";
        predictionLabel.classList.add(data.prediction.toLowerCase());

        resultContainer.style.display = "block";
        loadHistory();
    }

    // SAVE TO FIREBASE
    async function saveToFirebase(text, prediction, confidence) {
        await addDoc(collection(db, "stress_logs"), {
            text,
            prediction,
            confidence,
            created_at: serverTimestamp()
        });
        loadHistory();
    }

    // LOAD HISTORY FROM FIREBASE
    async function loadHistory() {
        const q = query(collection(db, "stress_logs"), orderBy("created_at", "desc"));
        const querySnapshot = await getDocs(q);

        historyList.innerHTML = "";
        querySnapshot.forEach(doc => {
            const d = doc.data();
            const div = document.createElement("div");
            div.className = "log-entry";
            div.innerHTML = `
                <p><strong>Status:</strong> <span class="${d.prediction.toLowerCase()}">${d.prediction}</span></p>
                <p><strong>Confidence:</strong> ${d.confidence}%</p>
                <p><strong>Text:</strong> ${d.text}</p>
            `;
            historyList.appendChild(div);
        });

        historyContainer.style.display = "block";
    }

    loadHistory(); // Load instantly when page opens
</script>


</body>
</html>